<!DOCTYPE html>
<!-- =======================================================================
     Project: SpellCheck (PWA) — UI Markup
     Purpose: Struttura semantica dell'app di calcolo difficoltà.
     Notes:
       - Bootstrap 5 usato per grid/utilities; stile custom in assets/css/style.css.
       - I modali sono implementati custom e non dipendono da Bootstrap JS.
       - I pulsanti 'Tema'/'Stile' agiscono su classi/variabili CSS lato client.
     Authoring: Refactor by ChatGPT — 2025-08-19
     ======================================================================= -->
<html lang="it">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   SpellCheck - Calcolo Difficolt&agrave; Incantesimi
  </title>
  <link href="manifest.json" rel="manifest"/>
  <link href="assets/img/favicon.ico" rel="icon" type="image/x-icon"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="assets/css/style.css" rel="stylesheet"/>
 </head>
 <body>
  <!--=== HEADER: titolo, logo, controlli PWA/Tema/Stile ===-->
  <header class="text-center mb-4">
   <h1>
    SpellCheck - Calcolo Difficolt&agrave; Incantesimi
   </h1>
   <img alt="Logo" class="img-fluid" loading="lazy" src="assets/img/logo.png" style="max-width:150px"/>
   <div class="text-center mt-4">
    <button class="btn btn-custom" id="install-button" style="display:none;">
     Installa App
    </button>
    <button aria-label="Cambia tema" class="btn btn-custom" id="theme-toggle" type="button">
     Tema
    </button>
    <button aria-label="Cambia stile" class="btn btn-custom" id="style-toggle" type="button">
     Stile
    </button>
   </div>
   <!-- Popup Volontà/Grado -->
   <!--=== MODAL: input Volontà/Grado Magia ===-->
   <div class="modal" id="popup-grado-magia" style="display:none;">
    <div class="modal-content">
     <h2>
      Inserisci Volont&agrave; e Grado di conoscenza della scuola di magia:
     </h2>
     <div class="mb-3 text-center">
      <div class="mago-input-container">
       <label class="mago-label" for="punteggio-volonta">
        Mod. Volont&agrave;:
       </label>
       <div class="input-group">
        <img alt="-" class="adjust-icon" onclick="decrementaVolonta()" src="assets/icons/minus.png"/>
        <input class="form-control mx-auto" id="punteggio-volonta" min="0" style="width:88px;" type="number" value="0"/>
        <img alt="+" class="adjust-icon" onclick="incrementaVolonta()" src="assets/icons/plus.png"/>
       </div>
      </div>
     </div>
     <div class="mb-3 text-center">
      <div class="mago-input-container">
       <label class="mago-label" for="grado-magia">
        Grado Magia:
       </label>
       <div class="input-group">
        <img alt="-" class="adjust-icon" onclick="decrementaGradoMagia()" src="assets/icons/minus.png"/>
        <input class="form-control mx-auto" id="grado-magia" min="0" style="width:88px;" type="number" value="0"/>
        <img alt="+" class="adjust-icon" onclick="incrementaGradoMagia()" src="assets/icons/plus.png"/>
       </div>
      </div>
     </div>
     <div class="text-center mt-4">
      <button class="btn btn-custom" id="submit-grado-magia">
       OK
      </button>
     </div>
    </div>
   </div>
   <!-- Popup risultati -->
   <!--=== MODAL: risultati calcolo difficoltà ===-->
   <div class="modal" id="popup-difficolta" style="display:none;">
    <div class="modal-content">
     <h2>
      Difficolt&agrave; Totale:
      <span id="difficolta-totale-popup">
       20
      </span>
     </h2>
     <div class="popup-row">
      <label>
       Lancio dado necessario:
      </label>
      <span id="lancio-dado-necessario">
       0
      </span>
     </div>
     <div class="popup-row">
      <label>
       Fatica accumulata:
      </label>
      <span id="fatica-accumulata">
       0
      </span>
     </div>
     <div class="popup-row">
      <label>
       Danno Base:
      </label>
      <span id="danno-base">
       0
      </span>
     </div>
     <div class="popup-row">
      <label>
       Dadi di Danno:
      </label>
      <span id="dadi-danno-riepilogo">
       Nessun dado
      </span>
     </div>
     <div class="popup-row">
      <label>
       Difficolt&agrave; per resistere:
      </label>
      <span id="difficolta-resistenza">
       0
      </span>
     </div>
     <div class="text-center mt-4">
      <button class="btn btn-custom" id="close-popup">
       Chiudi
      </button>
     </div>
    </div>
   </div>
  </header>
  <noscript>
   <div class="container">
    <div class="alert alert-warning">
     Per utilizzare l&rsquo;app &egrave; necessario abilitare JavaScript.
    </div>
   </div>
  </noscript>
  <div class="container">
   <!--=== FORM PRINCIPALE: parametri di lancio e opzioni ===-->
   <form>
    <!-- Distanza -->
    <div class="mb-3">
     <label class="form-label" for="distanza">
      A che distanza si trova il bersaglio?
     </label>
     <select class="form-select" id="distanza">
     </select>
    </div>
    <!-- Area -->
    <div class="mb-3">
     <label class="form-label" for="area">
      Quale sar&agrave; l'area d'effetto?
     </label>
     <select class="form-select" id="area" onchange="mostraInputBersagliDiametro()">
     </select>
    </div>
    <!-- Dinamici area -->
    <div class="mb-3 text-center" id="input-bersagli" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-bersagli">
       Ogni bersaglio oltre il primo (+5)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-bersagli')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-bersagli" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaInput('numero-bersagli')" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <!-- Sostituisci tutto il blocco esistente -->
    <div class="mb-3 text-center" id="input-diametro" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-diametro">
       Ogni 5 metri di diametro (+5)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-diametro')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-diametro" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaInput('numero-diametro')" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <!-- Durata -->
    <div class="mb-3">
     <label class="form-label" for="durata">
      Durata
     </label>
     <select class="form-select" id="durata" onchange="mostraInputDurata()">
     </select>
    </div>
    <div class="mb-3 text-center" id="input-round" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-round">
       Ogni round oltre il primo (+2)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-round')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-round" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaInput('numero-round')" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <div class="mb-3 text-center" id="input-minuti10" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-minuti10">
       Ogni 10 minuti (+6)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-minuti10')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-minuti10" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaInput('numero-minuti10')" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <!-- Modalità di lancio -->
    <!--=== SEZIONE: Modalità di lancio ===-->
    <h2 class="h4 text-center">
     Modalit&agrave; di lancio
    </h2>
    <div class="mb-3">
     <label class="form-label" for="gesti">
      Modalit&agrave; di lancio gestuali
     </label>
     <select class="form-select" id="gesti">
     </select>
    </div>
    <div class="mb-3">
     <label class="form-label" for="verbale">
      Modalit&agrave; di lancio verbale
     </label>
     <select class="form-select" id="verbale">
     </select>
    </div>
    <div class="mb-3">
     <label class="form-label" for="posizione">
      Modalit&agrave; di lancio in posizione
     </label>
     <select class="form-select" id="posizione">
     </select>
    </div>
    <!-- Variabili -->
    <!--=== SEZIONE: Variabili di lancio ===-->
    <h2 class="h4 text-center">
     Variabili di lancio
    </h2>
    <div class="form-check">
     <input class="form-check-input" id="variabile1" type="checkbox">
      <label class="form-check-label" for="variabile1" id="label-variabile1">
      </label>
     </input>
    </div>
    <div class="form-check">
     <input class="form-check-input" id="variabile2" onchange="mostraInputVariabili()" type="checkbox">
      <label class="form-check-label" for="variabile2" id="label-variabile2">
      </label>
     </input>
    </div>
    <!-- PRIMA: <div class="adjust-wrapper mb-3 text-center" id="input-mago-aggiuntivo" ...> -->
    <div class="mb-3 text-center" id="input-mago-aggiuntivo" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-magi-aggiuntivi">
       Ogni mago aggiuntivo (max 4) (+Grado Scuola)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaMagiAggiuntivi()" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-magi-aggiuntivi" min="0" onchange="aggiornaPunteggiMagiAggiuntivi()" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaMagiAggiuntivi()" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <div class="mb-3 text-center" id="punteggi-magi-aggiuntivi">
    </div>
    <div class="form-check">
     <input class="form-check-input" id="variabile3" onchange="mostraInputVariabili()" type="checkbox">
      <label class="form-check-label" for="variabile3" id="label-variabile3">
      </label>
     </input>
    </div>
    <!-- PRIMA: <div class="adjust-wrapper mb-3 text-center" id="input-lancio-rituale" ...> -->
    <div class="mb-3 text-center" id="input-lancio-rituale" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-rituali">
       Lancio con rituale (ogni 15 minuti) (-10)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-rituali')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-rituali" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaInput('numero-rituali')" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <div class="form-check">
     <input class="form-check-input" id="rounds-checkbox" onchange="mostraInputRound()" type="checkbox">
      <label class="form-check-label" for="rounds-checkbox" id="label-rounds">
      </label>
     </input>
    </div>
    <!-- PRIMA: <div class="adjust-wrapper mb-3 text-center" id="input-rounds" ...> -->
    <div class="mb-3 text-center" id="input-rounds" style="display:none;">
     <div class="mago-input-container">
      <label class="mago-label" for="numero-rounds">
       Round di concentrazione prima del lancio (max 10) (-1 per round)
      </label>
      <div class="input-group">
       <img alt="-" class="adjust-icon" onclick="decrementaInput('numero-rounds')" src="assets/icons/minus.png"/>
       <input class="form-control mx-auto" id="numero-rounds" max="10" min="0" style="width:88px;" type="number" value="1"/>
       <img alt="+" class="adjust-icon" onclick="incrementaRoundConcentrazione()" src="assets/icons/plus.png"/>
      </div>
     </div>
    </div>
    <!-- Effetti -->
    <!--=== SEZIONE: Effetti di lancio ===-->
    <h2 class="h4 text-center">
     Effetti di lancio
    </h2>
    <div class="form-check">
     <input class="form-check-input" id="effetto1" type="checkbox">
      <label class="form-check-label" for="effetto1" id="label-effetto1">
      </label>
     </input>
    </div>
    <div class="form-check">
     <input class="form-check-input" id="effetto2" type="checkbox">
      <label class="form-check-label" for="effetto2" id="label-effetto2">
      </label>
     </input>
    </div>
    <div class="form-check">
     <input class="form-check-input" id="effetto3" type="checkbox">
      <label class="form-check-label" for="effetto3" id="label-effetto3">
      </label>
     </input>
    </div>
    <!-- Modificatori Scuole -->
    <h2 class="h4 text-center">
     Modificatori per specifiche Scuole
    </h2>
    <h3 class="h4">
     Corpo
    </h3>
    <div class="form-check">
     <input class="form-check-input" id="corpo-checkbox" onchange="toggleCorpoDropdown()" type="checkbox">
      <label class="form-check-label" for="corpo-checkbox">
       Abilita modificatori per l'uso di Corpo
      </label>
     </input>
    </div>
    <div class="mb-3" id="corpo-dropdown-container" style="display:none;">
     <select class="form-select" id="modificatori_corpo">
     </select>
    </div>
    <h3 class="h4">
     Materia
    </h3>
    <div class="form-check">
     <input class="form-check-input" id="materia-checkbox" onchange="toggleMateriaDropdown()" type="checkbox">
      <label class="form-check-label" for="materia-checkbox">
       Abilita modificatori per l'uso di Materia
      </label>
     </input>
    </div>
    <div class="mb-3" id="materia-dropdown-container" style="display:none;">
     <select class="form-select" id="modificatori_materia">
     </select>
    </div>
    <h3 class="h4">
     Mente
    </h3>
    <div class="form-check">
     <input class="form-check-input" id="mente-checkbox" onchange="toggleMenteDropdown()" type="checkbox"/>
     <label class="form-check-label" for="mente-checkbox">
      Abilita modificatori per l'uso di Mente
     </label>
    </div>
    <div class="mb-3" id="mente-dropdown-container" style="display:none;">
     <select class="form-select" id="modificatori_mente">
     </select>
    </div>
    <!-- Dadi aggiuntivi -->
    <div class="dadi-aggiuntivi-container text-center">
     <h2 class="h4 text-center">
      Dadi aggiuntivi
     </h2>
     <!-- +1 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d1" onclick="decrementaInput('danni1')" src="assets/icons/minus.png" style="display:none;">
       <img alt="+1" class="dice-icon" id="toggle-d1" onclick="toggled1()" src="assets/icons/1.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d1" onclick="incrementaInput('danni1')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d1">
         </label>
         <div id="d1-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni1" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d4 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d4" onclick="decrementaInput('danni2')" src="assets/icons/minus.png" style="display:none;">
       <img alt="d4" class="dice-icon" id="toggle-d4" onclick="toggleD4()" src="assets/icons/d4.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d4" onclick="incrementaInput('danni2')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d4">
         </label>
         <div id="d4-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni2" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d6 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d6" onclick="decrementaInput('danni3')" src="assets/icons/minus.png" style="display:none;">
       <img alt="d6" class="dice-icon" id="toggle-d6" onclick="toggleD6()" src="assets/icons/d6.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d6" onclick="incrementaInput('danni3')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d6">
         </label>
         <div id="d6-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni3" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d8 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d8" onclick="decrementaInput('danni4')" src="assets/icons/minus.png" style="display:none;">
       <img alt="d8" class="dice-icon" id="toggle-d8" onclick="toggleD8()" src="assets/icons/d8.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d8" onclick="incrementaInput('danni4')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d8">
         </label>
         <div id="d8-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni4" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d10 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d10" onclick="decrementaInput('danni5')" src="assets/icons/minus.png" style="display:none;">
       <img alt="d10" class="dice-icon" id="toggle-d10" onclick="toggleD10()" src="assets/icons/d10.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d10" onclick="incrementaInput('danni5')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d10">
         </label>
         <div id="d10-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni5" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d12 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d12" onclick="decrementaInput('danni6')" src="assets/icons/minus.png" style="display:none;">
       <img alt="d12" class="dice-icon" id="toggle-d12" onclick="toggleD12()" src="assets/icons/d12.png">
        <img alt="+" class="adjust-icon mx-auto" id="plus-d12" onclick="incrementaInput('danni6')" src="assets/icons/plus.png" style="display:none;">
         <label class="form-label d-block" id="label-d12">
         </label>
         <div id="d12-controls" style="display:none;">
          <input class="form-control mx-auto" id="danni6" min="0" type="number" value="0"/>
         </div>
        </img>
       </img>
      </img>
     </div>
     <!-- d20 -->
     <div class="mb-3 text-center">
      <img alt="-" class="adjust-icon mx-auto" id="minus-d20" onclick="decrementaInput('danni7')" src="assets/icons/minus.png" style="display:none;"/>
      <img alt="d20" class="dice-icon" id="toggle-d20" onclick="toggleD20()" src="assets/icons/d20.png"/>
      <img alt="+" class="adjust-icon mx-auto" id="plus-d20" onclick="incrementaInput('danni7')" src="assets/icons/plus.png" style="display:none;"/>
      <label class="form-label d-block" id="label-d20">
      </label>
      <div id="d20-controls" style="display:none;">
       <input class="form-control mx-auto" id="danni7" min="0" type="number" value="0"/>
      </div>
     </div>
    </div>
    <!-- CTA -->
    <div class="button-container">
     <button class="btn btn-custom" onclick="calcolaDifficolta()" type="button">
      Calcola Difficolt&agrave;
     </button>
     <button class="btn btn-custom" onclick="ripristinaValori()" type="button">
      Reset
     </button>
    </div>
   </form>
  </div>
  <footer class="text-center mt-4">
   <p>
    &copy; 2024 CrypticSentinel - Open Source GDR - SpellCheck - ver 202508190905
   </p>
  </footer>
  <script>
   if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('./service-worker.js');

      // 1) Quando trova un update
      reg.addEventListener('updatefound', () => {
        const newWorker = reg.installing;
        if (!newWorker) return;
        newWorker.addEventListener('statechange', () => {
          // 'installed' + esiste un controller => SW aggiornato, app già controllata dal vecchio SW
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            // Reload "morbido": evita loop usando un flag
            if (!sessionStorage.getItem('sw-reloaded')) {
              sessionStorage.setItem('sw-reloaded', '1');
              window.location.reload();
            }
          }
        });
      });

      // 2) Fallback: se cambia il controller, ricarica una sola volta
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (!sessionStorage.getItem('sw-reloaded')) {
          sessionStorage.setItem('sw-reloaded', '1');
          window.location.reload();
        }
      });
    } catch (e) {
      console.error('SW registration failed:', e);
    }
  });
}
  </script>
  <script src="app.bundle.js">
  </script>
 </body>
</html>
